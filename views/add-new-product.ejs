<%- include('partials/header') %>

<div class="grid grid-cols-1 lg:grid-cols-12 gap-8 px-4 sm:px-6 lg:px-8 py-8">
    <!-- Left Sidebar: Bantuan & Rekomendasi -->
    <aside class="lg:col-span-3 space-y-6">
        <!-- Rekomendasi Panel -->
        <div class="p-4 border rounded-lg shadow-sm bg-white">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Rekomendasi</h3>
            <ul id="recommendation-checklist" class="space-y-2 text-sm">
                <li id="rec-photo" class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-2 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Tambahkan minimal 3 foto produk
                </li>
                <li id="rec-video" class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-2 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Tambahkan video
                </li>
                <li id="rec-name" class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-2 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Nama produk (25-100 karakter)
                </li>
                <li id="rec-desc" class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-2 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    Deskripsi (min. 100 karakter)
                </li>
                
            </ul>
        </div>
        <!-- Tips Panel -->
        <div id="tips-panel" class="p-4 border rounded-lg bg-blue-50">
             <div class="flex items-center mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <h3 id="tips-title" class="text-lg font-semibold text-blue-800">Tips</h3>
            </div>
            <p id="tips-content" class="text-sm text-blue-700">Arahkan kursor atau klik pada kolom isian untuk melihat tips dan penjelasan lebih lanjut.</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:col-span-6">
         <h1 class="text-3xl font-bold text-gray-800 mb-4">Tambahkan Produk Baru</h1>

    <div class="mb-6 border-b border-gray-200">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="product-form-tabs" role="tablist">
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg active-tab" id="info-produk-tab" type="button" role="tab" aria-controls="info-produk" aria-selected="true">1. Informasi Produk</button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="info-penjualan-tab" type="button" role="tab" aria-controls="info-penjualan" aria-selected="false">2. Informasi Penjualan</button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="pengiriman-tab" type="button" role="tab" aria-controls="pengiriman" aria-selected="false">3. Pengiriman</button>
            </li>
            <li role="presentation">
                <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:hover:border-gray-300" id="lainnya-tab" type="button" role="tab" aria-controls="lainnya" aria-selected="false">4. Lainnya</button>
            </li>
        </ul>
    </div>

    <form action="/api/v1/products" method="POST" class="bg-white p-6 rounded-lg shadow-md">
        <!-- Informasi Produk -->
        <section class="mb-6" id="info-produk">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">1. Informasi Produk</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="product-name" class="block text-sm font-medium text-gray-700">Nama Produk <span class="text-red-500">*</span></label>
                    <input type="text" id="product-name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required placeholder="Nama Merek + Tipe Produk + Fitur Produk (Bahan, Warna, Ukuran, Variasi)" maxlength="255">
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Deskripsi <span class="text-red-500">*</span></label>
                    <textarea id="description" name="description" rows="4" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required maxlength="3000"></textarea>
                </div>
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700">Kategori <span class="text-red-500">*</span></label>
                    <select id="category" name="categoryId" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                        <% categories.forEach(category => { %>
                            <option value="<%= category.id %>"><%= category.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label for="gtin" class="block text-sm font-medium text-gray-700">GTIN (Global Trade Item Number)
                        <span class="inline-block ml-1 cursor-pointer" title="Global Trade Item Number adalah identifikasi unik produk yang digunakan secara internasional.">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </span>
                    </label>
                    <input type="text" id="gtin" name="gtin" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <div class="mt-2 flex items-center">
                        <input type="checkbox" id="no-gtin" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="no-gtin" class="ml-2 block text-sm text-gray-900">Produk tanpa GTIN</label>
                    </div>
                </div>
                <div class="col-span-full">
                    <label class="block text-sm font-medium text-gray-700">Foto Produk <span class="text-red-500">*</span></label>
                    <div class="mt-1 flex items-center space-x-4">
                        <input type="file" id="product-images" name="productImages" accept="image/*" multiple class="hidden">
                        <label for="product-images" class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                            Tambahkan Foto (<span id="image-count">0</span>/9)
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="radio" id="ratio-1-1" name="imageRatio" value="1:1" checked>
                            <label for="ratio-1-1">Foto 1:1</label>
                            <input type="radio" id="ratio-3-4" name="imageRatio" value="3:4">
                            <label for="ratio-3-4">Foto 3:4</label>
                        </div>
                        <button type="button" id="view-example-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">
                            Lihat Contoh
                        </button>
                    </div>
                    <div id="image-preview-container" class="mt-4 grid grid-cols-3 gap-4">
                        <!-- Image previews will be inserted here -->
                    </div>
                </div>
                <div class="col-span-full">
                    <label class="block text-sm font-medium text-gray-700">Foto Produk Promosi <span class="text-red-500">*</span></label>
                    <p class="text-sm text-gray-500 mb-2">Foto ini akan digunakan di halaman promosi, hasil pencarian, dan rekomendasi untuk menarik minat pembeli. Format foto yang diminta adalah rasio 1:1.</p>
                    <div class="mt-1 flex items-center space-x-4">
                        <input type="file" id="promo-product-image" name="promoProductImage" accept="image/*" class="hidden" required>
                        <label for="promo-product-image" class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                            Tambahkan Foto Promosi (1/1)
                        </label>
                        <div id="promo-image-preview-container" class="flex items-center space-x-2">
                            <!-- Promo image preview will be inserted here -->
                        </div>
                    </div>
                </div>
                <div class="col-span-full">
                    <label class="block text-sm font-medium text-gray-700">Video Produk</label>
                    <div class="mt-2 flex items-center space-x-4">
                        <input type="radio" id="video-upload-option" name="video-source" value="upload" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                        <label for="video-upload-option" class="text-sm text-gray-900">Upload Video</label>

                        <input type="radio" id="video-youtube-option" name="video-source" value="youtube" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="video-youtube-option" class="text-sm text-gray-900">Link YouTube</label>
                    </div>

                    <div id="video-upload-section" class="mt-4">
                        <p class="text-sm text-gray-500 mb-2">Ukuran file maksimal 30MB, resolusi tidak melebihi 1280 x 1280px, durasi video antara 10 hingga 60 detik, format file MP4.</p>
                        <div class="mt-1 flex items-center space-x-4">
                            <input type="file" id="product-video" name="productVideo" accept="video/mp4" class="hidden">
                            <label for="product-video" class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                                Tambahkan Video
                            </label>
                            <div id="video-preview-container" class="flex items-center space-x-2">
                                <!-- Video preview will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <div id="video-youtube-section" class="mt-4 hidden">
                        <label for="youtube-link" class="block text-sm font-medium text-gray-700">Link Video YouTube</label>
                        <input type="text" id="youtube-link" name="youtubeLink" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Contoh: https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                        <div id="youtube-preview-container" class="mt-2">
                            <!-- YouTube video preview will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Informasi Penjualan -->
        <section class="mb-6" id="info-penjualan">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">2. Informasi Penjualan</h2>

            <!-- Variasi Section -->
            <div class="mb-6 p-4 border rounded-md bg-gray-50">
                <label class="block text-sm font-medium text-gray-700 mb-2">Variasi</label>
                <button type="button" id="toggle-variations-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded">
                    + Aktifkan Variasi
                </button>

                <div id="variations-container" class="mt-4 hidden">
                    <!-- Variation Group 1 -->
                    <div class="variation-group border p-4 rounded-md bg-white mb-4">
                        <div class="flex justify-end">
                            <button type="button" class="remove-variation-group-btn text-gray-400 hover:text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="variation-name-1" class="block text-sm font-medium text-gray-700">Variasi 1</label>
                                <input type="text" id="variation-name-1" name="variationName1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Cth. Warna, dll" maxlength="14">
                            </div>
                            <div class="col-span-full">
                                <label class="block text-sm font-medium text-gray-700">Opsi</label>
                                <div id="variation-options-container-1">
                                    <!-- Initial Option -->
                                    <div class="flex items-center space-x-2 mb-2 variation-option-row">
                                        <input type="text" name="variationOption1[]" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Cth. Merah, dll" maxlength="20">
                                        <button type="button" class="text-gray-400 hover:text-gray-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-4 4 4 4-4V5h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                        <button type="button" class="remove-variation-option-btn text-red-400 hover:text-red-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <button type="button" class="add-variation-option-btn mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded text-sm">
                                    + Tambah Opsi
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="add-variation-group-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                        + Tambah Variasi 2
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Harga -->
                <div>
                    <label for="price" class="block text-sm font-medium text-gray-700">Harga <span class="text-red-500">*</span></label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">Rp</span>
                        </div>
                        <input type="number" id="price" name="price" class="block w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Mohon masukkan" required min="0">
                    </div>
                </div>
                <!-- Stok -->
                <div>
                    <label for="stock" class="block text-sm font-medium text-gray-700">Stok <span class="text-red-500">*</span>
                        <span class="inline-block ml-1 cursor-pointer" title="Jumlah stok produk yang tersedia.">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </span>
                    </label>
                    <input type="number" id="stock" name="stock" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required min="0" value="0">
                </div>
                <!-- Min. Jumlah Pembelian -->
                <div>
                    <label for="min-purchase" class="block text-sm font-medium text-gray-700">Min. Jumlah Pembelian <span class="text-red-500">*</span></label>
                    <input type="number" id="min-purchase" name="minPurchase" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required min="1" value="1">
                    <p class="mt-1 text-sm text-gray-500">Jumlah minimum produk yang harus dibeli dalam satu transaksi.</p>
                </div>
                <!-- Maks. Jumlah Pembelian -->
                <div>
                    <label for="max-purchase" class="block text-sm font-medium text-gray-700">Maks. Jumlah Pembelian
                        <span class="inline-block ml-1 cursor-pointer" title="Jumlah maksimum produk yang bisa dibeli.">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </span>
                    </label>
                    <select id="max-purchase" name="maxPurchaseType" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="unlimited" selected>Tanpa Batas</option>
                        <option value="per-order">Per Pesanan</option>
                        <option value="per-period">Per Periode</option>
                    </select>
                    <div id="max-purchase-details" class="mt-2 hidden">
                        <!-- Conditional input for max purchase -->
                        <input type="number" id="max-purchase-value" name="maxPurchaseValue" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Masukkan jumlah">
                        <div id="max-purchase-period-details" class="mt-2 hidden">
                            <select id="max-purchase-period" name="maxPurchasePeriod" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                                <option value="daily">Per Hari</option>
                                <option value="weekly">Per Minggu</option>
                                <option value="monthly">Per Bulan</option>
                            </select>
                        </div>
                    </div>
                    <p id="max-purchase-description" class="mt-1 text-sm text-red-500">Maks. jumlah pembelian belum diatur.</p>
                </div>
            </div>

            <!-- Grosir Section -->
            <div class="mb-6 p-4 border rounded-md bg-gray-50 mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Grosir</label>
                <button type="button" id="add-wholesale-price-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded">
                    + Tambah Harga Grosir
                </button>
                <div id="wholesale-prices-container" class="mt-4">
                    <!-- Wholesale price tiers will be added here -->
                </div>
                <p class="mt-4 text-sm text-gray-500">Harga grosir akan disembunyikan secara otomatis jika produk sedang dalam promosi tertentu (Kombo Hemat & Paket Diskon).</p>
            </div>
        </section>

        <!-- Pengiriman -->
        <section class="mb-6" id="pengiriman">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">3. Pengiriman</h2>
            <div class="space-y-6">
                <!-- Berat -->
                <div>
                    <label for="weight" class="block text-sm font-medium text-gray-700">Berat <span class="text-red-500">*</span></label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="weight" name="weight" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 pr-12" placeholder="0" required>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">gr</span>
                        </div>
                    </div>
                </div>

                <!-- Ukuran Paket -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Ukuran Paket</label>
                    <div class="mt-1 grid grid-cols-3 gap-4">
                        <div>
                            <label for="length" class="block text-xs text-gray-500">Panjang</label>
                            <div class="relative rounded-md shadow-sm">
                                <input type="number" name="length" id="length" class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 pr-10">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">cm</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="width" class="block text-xs text-gray-500">Lebar</label>
                             <div class="relative rounded-md shadow-sm">
                                <input type="number" name="width" id="width" class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 pr-10">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">cm</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="height" class="block text-xs text-gray-500">Tinggi</label>
                            <div class="relative rounded-md shadow-sm">
                                <input type="number" name="height" id="height" class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3 pr-10">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">cm</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Produk Berbahaya -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Produk Berbahaya <span class="text-red-500">*</span></label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="dangerous-no" name="dangerousProduct" type="radio" value="false" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="dangerous-no" class="ml-3 block text-sm font-medium text-gray-700">Tidak</label>
                        </div>
                        <div class="flex items-center">
                            <input id="dangerous-yes" name="dangerousProduct" type="radio" value="true" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="dangerous-yes" class="ml-3 block text-sm font-medium text-gray-700">Mengandung baterai/magnet/cairan/bahan mudah terbakar</label>
                        </div>
                    </div>
                </div>

                <!-- Ongkos Kirim -->
                <div class="p-4 border rounded-md bg-gray-50">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ongkos Kirim</label>
                    <p class="text-sm text-gray-500 mb-4">Atur jasa kirim yang Anda kelola sendiri. Biaya akan dihitung berdasarkan aturan yang Anda buat di bawah ini.</p>
                    <div id="manual-shipping-list" class="space-y-2 mb-4">
                        <!-- Manual shipping methods will be listed here -->
                    </div>
                    <button type="button" id="add-manual-shipping-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded">
                        + Tambah Jasa Kirim Manual
                    </button>
                </div>

                <!-- Pre-order -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Pre-Order</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="preorder-no" name="preOrder" type="radio" value="false" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="preorder-no" class="ml-3 block text-sm font-medium text-gray-700">Tidak</label>
                        </div>
                        <p class="text-xs text-gray-500 ml-7">Produk harus dikirim dalam 2 hari kerja.</p>
                        <div class="flex items-center">
                            <input id="preorder-yes" name="preOrder" type="radio" value="true" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="preorder-yes" class="ml-3 block text-sm font-medium text-gray-700">Ya</label>
                        </div>
                        <div id="preorder-duration-container" class="hidden ml-7">
                            <label for="preorder-days" class="block text-sm font-medium text-gray-700">Durasi Pre-order (hari)</label>
                            <input type="number" name="preorderDays" id="preorder-days" class="mt-1 block w-full max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3" min="3">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lainnya -->
        <section class="mb-6" id="lainnya">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">4. Lainnya</h2>
            <div class="space-y-6">
                <!-- Kondisi -->
                <div>
                    <label for="condition" class="block text-sm font-medium text-gray-700">Kondisi</label>
                    <select id="condition" name="condition" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="new" selected>Baru</option>
                        <option value="used">Bekas</option>
                    </select>
                </div>

                <!-- Jadwal Ditampilkan -->
                <div>
                    <label for="scheduled-display" class="block text-sm font-medium text-gray-700">
                        Jadwal Ditampilkan
                        <span class="inline-block ml-1 cursor-pointer" title="Pilih tanggal dan waktu kapan produk ini akan mulai ditampilkan di toko Anda.">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4s-1.79 4-4 4c-1.742 0-3.223-.835-3.772-2M12 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </span>
                    </label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <input type="datetime-local" id="scheduled-display" name="scheduledDisplay" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 pl-10 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <!-- SKU Induk -->
                <div>
                    <label for="parent-sku" class="block text-sm font-medium text-gray-700">SKU Induk</label>
                    <input type="text" id="parent-sku" name="parentSku" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Masukkan SKU utama/induk produk">
                </div>
                
                <!-- Catatan Tambahan (existing) -->
                <div>
                    <label for="notes" class="block text-sm font-medium text-gray-700">Catatan Tambahan</label>
                    <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>
            </div>
        </section>

        <!-- Tombol Aksi -->
        <div class="flex justify-end space-x-4">
            <button type="button" onclick="window.history.back()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                Kembali
            </button>
            <button type="submit" name="action" value="archive" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded">
                Simpan & Arsipkan
            </button>
            <button type="submit" name="action" value="publish" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
                Simpan & Tampilkan
            </button>
        </div>
            </form>
    </main>

    <!-- Right Sidebar: Preview -->
    <aside class="lg:col-span-3">
        <div class="sticky top-8 p-4 border rounded-lg shadow-sm bg-white">
            <h3 class="text-lg font-semibold text-gray-800">Preview</h3>
            <p class="text-sm text-gray-500 mb-4">Rincian Produk</p>
            
            <div id="preview-image-container" class="w-full h-48 bg-gray-200 rounded-md flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
            </div>
            
            <div id="preview-details">
                <p id="preview-name" class="font-semibold text-gray-800 truncate">Nama Produk</p>
                <p id="preview-variations" class="text-sm text-gray-500 mt-1">0 Variasi Tersedia</p>
                <p id="preview-price" class="text-xl font-bold text-red-600 mt-2">Rp -.---</p>
            </div>

            <div class="mt-4 pt-4 border-t">
                <div class="flex items-center">
                    <div>
                        <p class="font-semibold"><%= user.name %></p>
                    </div>
                    <button class="ml-auto border border-gray-300 rounded-md px-3 py-1 text-sm">Kunjungi</button>
                </div>
            </div>

            <div class="mt-4 grid grid-cols-3 gap-2">
                <button class="col-span-1 bg-green-100 text-green-800 rounded-md p-2 text-sm flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></button>
                <button class="col-span-1 bg-blue-100 text-blue-800 rounded-md p-2 text-sm flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg></button>
                <button class="col-span-1 bg-red-600 text-white rounded-md p-2 text-sm">Beli Sekarang</button>
            </div>
            <p class="text-xs text-gray-400 mt-4 text-center">Tampilan di aplikasi mungkin sedikit berbeda</p>
        </div>
    </aside>
</div>

<!-- Manual Shipping Modal -->
<div id="manual-shipping-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Tambah Jasa Kirim Manual</h3>
            <div class="mt-2 space-y-4">
                <div>
                    <label for="shipping-service-name" class="block text-sm font-medium text-gray-700">Nama Layanan Kirim</label>
                    <input type="text" id="shipping-service-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Contoh: Kurir Instan Toko">
                </div>
                <div>
                    <label for="shipping-calc-method" class="block text-sm font-medium text-gray-700">Metode Kalkulasi Biaya</label>
                    <select id="shipping-calc-method" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                        <option value="flat">Tarif Tetap (Flat Rate)</option>
                        <option value="weight">Berdasarkan Berat</option>
                    </select>
                </div>
                <!-- Dynamic cost input section -->
                <div id="shipping-cost-inputs">
                    <!-- Flat Rate -->
                    <div id="flat-rate-input">
                        <label for="flat-rate-cost" class="block text-sm font-medium text-gray-700">Biaya Ongkir</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">Rp</span>
                            </div>
                            <input type="number" id="flat-rate-cost" class="block w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md" placeholder="0">
                        </div>
                    </div>
                    <!-- Weight Based -->
                    <div id="weight-based-input" class="hidden">
                        <label class="block text-sm font-medium text-gray-700">Aturan Biaya Berdasarkan Berat</label>
                        <div id="weight-ranges-container" class="mt-2 space-y-2">
                            <!-- Weight range rows will be added here -->
                        </div>
                        <button type="button" id="add-weight-range-btn" class="mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded text-sm">
                            + Tambah Rentang
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-4 flex justify-end space-x-2">
                <button id="cancel-shipping-modal" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Batal</button>
                <button id="save-shipping-modal" type="button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">Simpan</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- New JavaScript for Pengiriman Tab ---
        const preorderYes = document.getElementById('preorder-yes');
        const preorderNo = document.getElementById('preorder-no');
        const preorderDurationContainer = document.getElementById('preorder-duration-container');

        if(preorderYes && preorderNo && preorderDurationContainer) {
            preorderYes.addEventListener('change', () => {
                if (preorderYes.checked) {
                    preorderDurationContainer.classList.remove('hidden');
                }
            });
            preorderNo.addEventListener('change', () => {
                if (preorderNo.checked) {
                    preorderDurationContainer.classList.add('hidden');
                }
            });
        }

        // Manual Shipping Modal Logic
        const addManualShippingBtn = document.getElementById('add-manual-shipping-btn');
        const shippingModal = document.getElementById('manual-shipping-modal');
        const cancelShippingModalBtn = document.getElementById('cancel-shipping-modal');
        const saveShippingModalBtn = document.getElementById('save-shipping-modal');
        const shippingCalcMethod = document.getElementById('shipping-calc-method');
        const flatRateInput = document.getElementById('flat-rate-input');
        const weightBasedInput = document.getElementById('weight-based-input');
        const addWeightRangeBtn = document.getElementById('add-weight-range-btn');
        const weightRangesContainer = document.getElementById('weight-ranges-container');
        const manualShippingList = document.getElementById('manual-shipping-list');

        if(addManualShippingBtn) {
            addManualShippingBtn.addEventListener('click', () => {
                shippingModal.classList.remove('hidden');
            });
        }

        if(cancelShippingModalBtn) {
            cancelShippingModalBtn.addEventListener('click', () => {
                shippingModal.classList.add('hidden');
            });
        }
        
        if(shippingCalcMethod) {
            shippingCalcMethod.addEventListener('change', () => {
                if (shippingCalcMethod.value === 'flat') {
                    flatRateInput.classList.remove('hidden');
                    weightBasedInput.classList.add('hidden');
                } else {
                    flatRateInput.classList.add('hidden');
                    weightBasedInput.classList.remove('hidden');
                }
            });
        }

        if(addWeightRangeBtn) {
            addWeightRangeBtn.addEventListener('click', () => {
                const newRange = document.createElement('div');
                newRange.className = 'flex items-center space-x-2 weight-range-row';
                newRange.innerHTML = `
                    <input type="number" placeholder="0" class="w-24 border-gray-300 rounded-md text-sm p-2">
                    <span class="text-gray-500">-</span>
                    <input type="number" placeholder="1000" class="w-24 border-gray-300 rounded-md text-sm p-2">
                    <span class="text-gray-500">gr</span>
                    <div class="relative rounded-md shadow-sm flex-grow">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">Rp</span>
                        </div>
                        <input type="number" class="block w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md" placeholder="10000">
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700 remove-weight-range p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                `;
                weightRangesContainer.appendChild(newRange);
            });
        }

        if(weightRangesContainer) {
            weightRangesContainer.addEventListener('click', (e) => {
                if (e.target.closest('.remove-weight-range')) {
                    e.target.closest('.weight-range-row').remove();
                }
            });
        }

        if(saveShippingModalBtn) {
            saveShippingModalBtn.addEventListener('click', () => {
                const serviceName = document.getElementById('shipping-service-name').value;
                if (!serviceName) {
                    alert('Nama layanan kirim tidak boleh kosong.');
                    return;
                }
                // In a real app, you'd collect all the data and store it, probably in hidden inputs.
                // For this demo, we'll just display the name.
                const newServiceDiv = document.createElement('div');
                newServiceDiv.className = 'flex items-center justify-between p-3 border rounded-md bg-white shadow-sm';
                newServiceDiv.innerHTML = `
                    <div>
                        <span class="font-medium">${serviceName}</span>
                        <span class="text-sm text-gray-500 ml-2">(${shippingCalcMethod.value === 'flat' ? 'Tarif Tetap' : 'Berdasarkan Berat'})</span>
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700 remove-manual-shipping font-medium">Hapus</button>
                `;
                manualShippingList.appendChild(newServiceDiv);
                shippingModal.classList.add('hidden');
                // Clear modal fields for next time
                document.getElementById('shipping-service-name').value = '';
                document.getElementById('flat-rate-cost').value = '';
                weightRangesContainer.innerHTML = '';
            });
        }

        if(manualShippingList) {
            manualShippingList.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-manual-shipping')) {
                    e.target.parentElement.parentElement.remove();
                }
            });
        }
    });
</script>

<%- include('partials/footer') %>

<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: "Poppins", sans-serif;
  }
  form > section {
      display: none;
  }
</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        console.log("DOM Content Loaded.");

        const productImagesInput = document.getElementById("product-images");
        const imageCountSpan = document.getElementById("image-count");
        const imagePreviewContainer = document.getElementById("image-preview-container");
        const mainPreviewContainer = document.getElementById('preview-image-container');
        const viewExampleBtn = document.getElementById("view-example-btn");
        const MAX_IMAGES = 9;

        let uploadedFiles = [];

        const defaultPreview = mainPreviewContainer.innerHTML;

        productImagesInput.addEventListener("change", (event) => {
            const files = Array.from(event.target.files);
            
            const newImageFiles = files.filter(file => file.type.startsWith('image/') && uploadedFiles.length < MAX_IMAGES);

            if (newImageFiles.length === 0 && files.length > 0) {
                alert("Hanya file gambar yang diizinkan atau batas maksimum 9 gambar telah tercapai.");
                return;
            }

            if (newImageFiles.length > 0 && uploadedFiles.length === 0) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    mainPreviewContainer.innerHTML = `<img src="${e.target.result}" alt="Preview Produk" class="w-full h-full object-cover rounded-md">`;
                };
                reader.readAsDataURL(newImageFiles[0]);
            }

            newImageFiles.forEach(file => {
                if (uploadedFiles.length < MAX_IMAGES) {
                    uploadedFiles.push(file);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imgDiv = document.createElement("div");
                        imgDiv.className = "relative group";
                        imgDiv.setAttribute('data-file-name', file.name);
                        imgDiv.innerHTML = `
                            <img src="${e.target.result}" class="w-full h-32 object-cover rounded-md border border-gray-300">
                            <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity remove-image-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        `;
                        imagePreviewContainer.appendChild(imgDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });

            updateImageCount();
            productImagesInput.value = '';
        });

        imagePreviewContainer.addEventListener("click", (event) => {
            const removeBtn = event.target.closest(".remove-image-btn");
            if (removeBtn) {
                const imageDiv = removeBtn.closest(".relative.group");
                const fileNameToRemove = imageDiv.dataset.fileName;
                
                uploadedFiles = uploadedFiles.filter(file => file.name !== fileNameToRemove);
                imageDiv.remove();
                updateImageCount();

                if (uploadedFiles.length > 0) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        mainPreviewContainer.innerHTML = `<img src="${e.target.result}" alt="Preview Produk" class="w-full h-full object-cover rounded-md">`;
                    };
                    reader.readAsDataURL(uploadedFiles[0]);
                } else {
                    mainPreviewContainer.innerHTML = defaultPreview;
                }
            }
        });

        viewExampleBtn.addEventListener("click", () => {
            alert("Contoh tampilan foto produk akan ditampilkan di sini.");
        });

        function updateImageCount() {
            imageCountSpan.textContent = uploadedFiles.length;
        }

        const promoProductImageInput = document.getElementById("promo-product-image");
        const promoImagePreviewContainer = document.getElementById("promo-image-preview-container");
        let promoImageFile = null;

        promoProductImageInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                promoImageFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    promoImagePreviewContainer.innerHTML = `
                        <div class="relative group">
                            <img src="${e.target.result}" class="w-24 h-24 object-cover rounded-md border border-gray-300">
                            <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity remove-promo-image-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path fill-rule="evenodd" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                promoImageFile = null;
                promoImagePreviewContainer.innerHTML = '';
                alert("Hanya file gambar yang diizinkan untuk Foto Produk Promosi.");
            }
        });

        promoImagePreviewContainer.addEventListener("click", (event) => {
            if (event.target.closest(".remove-promo-image-btn")) {
                promoImageFile = null;
                promoImagePreviewContainer.innerHTML = '';
                promoProductImageInput.value = '';
            }
        });

        const videoUploadOption = document.getElementById("video-upload-option");
        const videoYoutubeOption = document.getElementById("video-youtube-option");
        const videoUploadSection = document.getElementById("video-upload-section");
        const videoYoutubeSection = document.getElementById("video-youtube-section");
        const productVideoInput = document.getElementById("product-video");
        const videoPreviewContainer = document.getElementById("video-preview-container");
        const youtubeLinkInput = document.getElementById("youtube-link");
        const youtubePreviewContainer = document.getElementById("youtube-preview-container");

        let productVideoFile = null;

        function getYouTubeId(url) {
            const regExp = /^.*(?:youtu.be\/|v\/|e\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[1].length === 11) ? match[1] : null;
        }

        videoUploadOption.addEventListener("change", () => {
            if (videoUploadOption.checked) {
                videoUploadSection.classList.remove("hidden");
                videoYoutubeSection.classList.add("hidden");
                youtubeLinkInput.value = '';
                youtubePreviewContainer.innerHTML = '';
            }
        });

        videoYoutubeOption.addEventListener("change", () => {
            if (videoYoutubeOption.checked) {
                videoYoutubeSection.classList.remove("hidden");
                videoUploadSection.classList.add("hidden");
                productVideoInput.value = '';
                videoPreviewContainer.innerHTML = '';
                productVideoFile = null;
            }
        });

        productVideoInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
                if (file.type === 'video/mp4') {
                    if (file.size <= 30 * 1024 * 1024) { // 30MB
                        productVideoFile = file;
                        const videoURL = URL.createObjectURL(file);
                        videoPreviewContainer.innerHTML = `
                            <div class="relative group">
                                <video src="${videoURL}" controls class="w-48 h-auto rounded-md border border-gray-300"></video>
                                <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity remove-video-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        `;
                    } else {
                        productVideoFile = null;
                        videoPreviewContainer.innerHTML = '';
                        alert("Ukuran file video maksimal 30MB.");
                    }
                } else {
                    productVideoFile = null;
                    videoPreviewContainer.innerHTML = '';
                    alert("Hanya format MP4 yang diizinkan untuk Video Produk.");
                }
            } else {
                productVideoFile = null;
                videoPreviewContainer.innerHTML = '';
            }
        });

        videoPreviewContainer.addEventListener("click", (event) => {
            if (event.target.closest(".remove-video-btn")) {
                productVideoFile = null;
                videoPreviewContainer.innerHTML = '';
                productVideoInput.value = '';
            }
        });

        youtubeLinkInput.addEventListener("input", () => {
            const url = youtubeLinkInput.value;
            const videoId = getYouTubeId(url);
            if (videoId) {
                youtubePreviewContainer.innerHTML = `
                    <iframe width="320" height="180" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-md"></iframe>
                `;
            } else {
                youtubePreviewContainer.innerHTML = '';
            }
        });

        const gtinInput = document.getElementById("gtin");
        const noGtinCheckbox = document.getElementById("no-gtin");

        noGtinCheckbox.addEventListener("change", () => {
            if (noGtinCheckbox.checked) {
                gtinInput.value = '';
                gtinInput.disabled = true;
                gtinInput.removeAttribute('required');
            } else {
                gtinInput.disabled = false;
            }
        });

        const tabButtons = document.querySelectorAll('#product-form-tabs button');
        const tabSections = document.querySelectorAll('form > section');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active-tab', 'border-b-2', 'rounded-t-lg');
                    btn.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                    btn.setAttribute('aria-selected', 'false');
                });

                button.classList.add('active-tab', 'border-b-2', 'rounded-t-lg');
                button.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                button.setAttribute('aria-selected', 'true');

                tabSections.forEach(section => {
                    section.style.display = 'none';
                });

                const targetSection = document.getElementById(button.getAttribute('aria-controls'));
                if (targetSection) {
                    targetSection.style.display = 'block';
                }
            });
        });

        if (tabButtons.length > 0) {
            tabButtons[0].click();
        }

        const productNameInput = document.getElementById('product-name');
        const priceInput = document.getElementById('price');
        const previewName = document.getElementById('preview-name');
        const previewPrice = document.getElementById('preview-price');

        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
            }).format(number);
        };

        productNameInput.addEventListener('input', (e) => {
            const name = e.target.value;
            previewName.textContent = name || 'Nama Produk';
        });

        priceInput.addEventListener('input', (e) => {
            const price = e.target.value;
            previewPrice.textContent = formatRupiah(price || 0);
        });

        const toggleVariationsBtn = document.getElementById("toggle-variations-btn");
        const variationsContainer = document.getElementById("variations-container");
        const addVariationGroupBtn = document.getElementById("add-variation-group-btn");
        let variationGroupCount = 1;

        addVariationGroupBtn.addEventListener("click", () => {
            if (variationGroupCount >= 2) return;
            variationGroupCount++;

            const newVariationGroup = document.createElement("div");
            newVariationGroup.className = "variation-group border p-4 rounded-md bg-white mb-4";
            newVariationGroup.innerHTML = `
                <div class="flex justify-end">
                    <button type="button" class="remove-variation-group-btn text-gray-400 hover:text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="variation-name-${variationGroupCount}" class="block text-sm font-medium text-gray-700">Variasi ${variationGroupCount}</label>
                        <input type="text" id="variation-name-${variationGroupCount}" name="variationName${variationGroupCount}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Cth. Ukuran, dll" maxlength="14">
                    </div>
                    <div class="col-span-full">
                        <label class="block text-sm font-medium text-gray-700">Opsi</label>
                        <div id="variation-options-container-${variationGroupCount}">
                            <div class="flex items-center space-x-2 mb-2 variation-option-row">
                                <input type="text" name="variationOption${variationGroupCount}[]" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Cth. S, M, L" maxlength="20">
                                <button type="button" class="text-gray-400 hover:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-4 4 4 4-4V5h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2z" clip-rule="evenodd" /></svg></button>
                                <button type="button" class="remove-variation-option-btn text-red-400 hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg></button>
                            </div>
                        </div>
                        <button type="button" class="add-variation-option-btn mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded text-sm">+ Tambah Opsi</button>
                    </div>
                </div>
            `;
            addVariationGroupBtn.before(newVariationGroup);
            if (variationGroupCount >= 2) addVariationGroupBtn.classList.add("hidden");
        });

        toggleVariationsBtn.addEventListener("click", () => {
            variationsContainer.classList.toggle("hidden");
            const variationInputs = variationsContainer.querySelectorAll('input[name^="variationName"], input[name^="variationOption"]');
            if (variationsContainer.classList.contains("hidden")) {
                toggleVariationsBtn.textContent = "+ Aktifkan Variasi";
                variationInputs.forEach(input => {
                    input.dataset.originalName = input.name;
                    input.name = '';
                    input.disabled = true;
                    input.value = '';
                });
            } else {
                toggleVariationsBtn.textContent = "- Nonaktifkan Variasi";
                variationInputs.forEach(input => {
                    if (input.dataset.originalName) {
                        input.name = input.dataset.originalName;
                        delete input.dataset.originalName;
                    }
                    input.disabled = false;
                });
            }
        });

        document.addEventListener("click", (event) => {
            if (event.target.closest(".add-variation-option-btn")) {
                const optionsContainer = event.target.closest(".col-span-full").querySelector('div[id^="variation-options-container-"]');
                const variationGroupId = optionsContainer.id.split('-').pop();
                const newOptionRow = document.createElement("div");
                newOptionRow.className = "flex items-center space-x-2 mb-2 variation-option-row";
                newOptionRow.innerHTML = `
                    <input type="text" name="variationOption${variationGroupId}[]" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Cth. Merah, dll" maxlength="20">
                    <button type="button" class="text-gray-400 hover:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-4 4 4 4-4V5h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2h-2a1 1 0 100 2h2v2z" clip-rule="evenodd" /></svg></button>
                    <button type="button" class="remove-variation-option-btn text-red-400 hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg></button>
                `;
                optionsContainer.appendChild(newOptionRow);
            }

            if (event.target.closest(".remove-variation-option-btn")) {
                event.target.closest(".variation-option-row").remove();
            }

            if (event.target.closest(".remove-variation-group-btn")) {
                if (variationsContainer.querySelectorAll('.variation-group').length === 1) {
                    if (!variationsContainer.classList.contains("hidden")) {
                        toggleVariationsBtn.click();
                    }
                } else {
                    event.target.closest(".variation-group").remove();
                    variationGroupCount--;
                    addVariationGroupBtn.classList.remove("hidden");
                }
            }
        });

        const maxPurchaseSelect = document.getElementById("max-purchase");
        const maxPurchaseDetails = document.getElementById("max-purchase-details");
        const maxPurchaseValueInput = document.getElementById("max-purchase-value");
        const maxPurchasePeriodDetails = document.getElementById("max-purchase-period-details");
        const maxPurchaseDescription = document.getElementById("max-purchase-description");

        function updateMaxPurchaseVisibility() {
            const selectedType = maxPurchaseSelect.value;
            maxPurchaseDetails.classList.add("hidden");
            maxPurchasePeriodDetails.classList.add("hidden");
            maxPurchaseValueInput.removeAttribute("required");
            maxPurchaseDescription.classList.remove("hidden");

            if (selectedType === "per-order") {
                maxPurchaseDetails.classList.remove("hidden");
                maxPurchaseValueInput.setAttribute("required", "true");
                maxPurchaseDescription.textContent = "Atur Maks. jumlah pembelian setiap Pembeli per pesanan.";
                maxPurchaseDescription.classList.remove("text-red-500");
                maxPurchaseDescription.classList.add("text-gray-500");
            } else if (selectedType === "per-period") {
                maxPurchaseDetails.classList.remove("hidden");
                maxPurchasePeriodDetails.classList.remove("hidden");
                maxPurchaseValueInput.setAttribute("required", "true");
                maxPurchaseDescription.textContent = "Atur Maks. jumlah pembelian setiap Pembeli selama periode yang ditentukan, berapa pun jumlah pesanan yang dibuat.";
                maxPurchaseDescription.classList.remove("text-red-500");
                maxPurchaseDescription.classList.add("text-gray-500");
            } else {
                maxPurchaseDescription.textContent = "Maks. jumlah pembelian belum diatur.";
                maxPurchaseDescription.classList.add("text-red-500");
                maxPurchaseDescription.classList.remove("text-gray-500");
            }
        }

        maxPurchaseSelect.addEventListener("change", updateMaxPurchaseVisibility);
        updateMaxPurchaseVisibility();

        const addWholesalePriceBtn = document.getElementById("add-wholesale-price-btn");
        const wholesalePricesContainer = document.getElementById("wholesale-prices-container");
        let wholesaleTierCount = 0;

        addWholesalePriceBtn.addEventListener("click", () => {
            wholesaleTierCount++;
            const newWholesaleTier = document.createElement("div");
            newWholesaleTier.className = "wholesale-tier border p-3 rounded-md bg-white mb-2 flex items-center space-x-4";
            newWholesaleTier.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700">Min. Kuantitas</label>
                    <input type="number" name="wholesaleMinQuantity[]" class="mt-1 block w-24 border border-gray-300 rounded-md shadow-sm py-1 px-2" min="1" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Harga Grosir</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><span class="text-gray-500 sm:text-sm">Rp</span></div>
                        <input type="number" name="wholesalePrice[]" class="block w-28 pl-9 pr-3 py-1 border border-gray-300 rounded-md" placeholder="Harga" min="0" required>
                    </div>
                </div>
                <button type="button" class="remove-wholesale-tier-btn text-red-400 hover:text-red-600 mt-5"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg></button>
            `;
            wholesalePricesContainer.appendChild(newWholesaleTier);
        });

        wholesalePricesContainer.addEventListener("click", (event) => {
            if (event.target.closest(".remove-wholesale-tier-btn")) {
                event.target.closest(".wholesale-tier").remove();
            }
        });
    });
</script>

<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- React CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<%- include('partials/footer') %>