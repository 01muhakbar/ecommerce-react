<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tambah Produk Baru - E-Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto p-8">
      <a
        href="/dashboard"
        class="mb-4 inline-block text-blue-600 hover:underline"
        >&larr; Kembali ke Dasbor</a
      >

      <!-- Add Product Form Section -->
      <div class="bg-white p-8 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">
          Tambah Produk Baru
        </h1>
        <p class="text-gray-600 mb-6">
          Isi detail produk di bawah ini untuk menambahkannya ke katalog.
        </p>
        <form id="addProductForm">
          <!-- Product Name -->
          <div class="mb-4">
            <label
              for="productName"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Nama Produk</label
            >
            <input
              type="text"
              id="productName"
              name="name"
              required
              class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <!-- Product Description -->
          <div class="mb-4">
            <label
              for="productDescription"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Deskripsi</label
            >
            <textarea
              id="productDescription"
              name="description"
              rows="3"
              class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <!-- Product Price -->
          <div class="mb-4">
            <label
              for="productPrice"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Harga (Rp)</label
            >
            <input
              type="number"
              id="productPrice"
              name="price"
              required
              min="0"
              class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <!-- Product Stock -->
          <div class="mb-6">
            <label
              for="productStock"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Stok</label
            >
            <input
              type="number"
              id="productStock"
              name="stock"
              required
              min="0"
              class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <!-- Submit Button -->
          <button
            type="submit"
            class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full transition-colors duration-300"
          >
            Tambah Produk
          </button>
          <div id="addProductMessage" class="mt-4 text-center text-sm"></div>
        </form>
      </div>
    </div>

    <script>
      const addProductForm = document.getElementById("addProductForm");
      const addProductMessage = document.getElementById("addProductMessage");

      // Event listener untuk form tambah produk
      addProductForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(addProductForm);
        const productData = {
          name: formData.get("name"),
          description: formData.get("description"),
          price: parseFloat(formData.get("price")),
          stock: parseInt(formData.get("stock"), 10),
        };

        try {
          const response = await fetch("http://localhost:3000/api/v1/products", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              // Authorization header removed, relying on cookie
            },
            body: JSON.stringify(productData),
          });

          const result = await response.json();

          if (response.ok) {
            addProductMessage.textContent = "Produk berhasil ditambahkan!";
            addProductMessage.className =
              "mt-4 text-center text-sm text-green-600";
            addProductForm.reset(); // Kosongkan form
            // Arahkan kembali ke dasbor setelah 2 detik
            setTimeout(() => {
              window.location.href = "/dashboard";
            }, 2000);
          } else if (response.status === 401) { // Handle 401 Unauthorized
            // localStorage.removeItem("authToken"); // No longer needed as token is in cookie
            addProductMessage.textContent = "Sesi Anda telah berakhir atau tidak valid. Silakan login kembali.";
            addProductMessage.className = "mt-4 text-center text-sm text-red-600";
            setTimeout(() => {
              window.location.href = "/login"; // Redirect to login
            }, 2000);
          }
          else {
            addProductMessage.textContent =
              result.message || "Gagal menambahkan produk.";
            addProductMessage.className =
              "mt-4 text-center text-sm text-red-600";
          }
        } catch (error) {
          console.error("Add product error:", error);
          addProductMessage.textContent =
            "Terjadi kesalahan saat menambahkan produk.";
          addProductMessage.className = "mt-4 text-center text-sm text-red-600";
        }
      });
    </script>
    </script>
  </body>
</html>
